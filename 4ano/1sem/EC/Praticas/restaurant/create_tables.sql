-- =========================
-- Food Delivery Database
-- =========================

-- Drop tables if they exist (to avoid conflicts)
BEGIN
    EXECUTE IMMEDIATE 'DROP TABLE ITEM_PEDIDO CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE REVIEW CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE PEDIDO CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE PRATO CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE CATEGORIA CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE RESTAURANTE CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE CLIENTE CASCADE CONSTRAINTS';
    EXECUTE IMMEDIATE 'DROP TABLE ENTREGADOR CASCADE CONSTRAINTS';
EXCEPTION
    WHEN OTHERS THEN
        NULL;
END;
/

-- =========================
-- RESTAURANTE
-- =========================
CREATE TABLE RESTAURANTE (
    ID_RESTAURANTE NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    LOCALIZACAO VARCHAR2(200),
    TELEFONE VARCHAR2(20)
);

-- =========================
-- CLIENTE
-- =========================
CREATE TABLE CLIENTE (
    ID_CLIENTE NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100),
    TELEFONE VARCHAR2(20),
    ENDERECO VARCHAR2(200)
);

-- =========================
-- ENTREGADOR
-- =========================
CREATE TABLE ENTREGADOR (
    ID_ENTREGADOR NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    TELEFONE VARCHAR2(20),
    VEICULO VARCHAR2(50)
);

-- =========================
-- CATEGORIA
-- =========================
CREATE TABLE CATEGORIA (
    ID_CATEGORIA NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(50) NOT NULL
);

-- =========================
-- PRATO
-- =========================
CREATE TABLE PRATO (
    ID_PRATO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    PRECO NUMBER(8,2) NOT NULL,
    ID_RESTAURANTE NUMBER NOT NULL,
    ID_CATEGORIA NUMBER NOT NULL,
    CONSTRAINT FK_PRATO_RESTAURANTE FOREIGN KEY (ID_RESTAURANTE)
        REFERENCES RESTAURANTE(ID_RESTAURANTE),
    CONSTRAINT FK_PRATO_CATEGORIA FOREIGN KEY (ID_CATEGORIA)
        REFERENCES CATEGORIA(ID_CATEGORIA)
);

-- =========================
-- PEDIDO
-- =========================
CREATE TABLE PEDIDO (
    ID_PEDIDO NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY PRIMARY KEY,
    DATA_PEDIDO DATE DEFAULT SYSDATE,
    VALOR_TOTAL NUMBER(10,2),
    ID_CLIENTE NUMBER NOT NULL,
    ID_ENTREGADOR NUMBER,
    ID_RESTAURANTE NUMBER NOT NULL,
    CONSTRAINT FK_PEDIDO_CLIENTE FOREIGN KEY (ID_CLIENTE)
        REFERENCES CLIENTE(ID_CLIENTE),
    CONSTRAINT FK_PEDIDO_ENTREGADOR FOREIGN KEY (ID_ENTREGADOR)
        REFERENCES ENTREGADOR(ID_ENTREGADOR),
    CONSTRAINT FK_PEDIDO_RESTAURANTE FOREIGN KEY (ID_RESTAURANTE)
        REFERENCES RESTAURANTE(ID_RESTAURANTE)
);

-- =========================
-- ITEM_PEDIDO
-- =========================
CREATE TABLE ITEM_PEDIDO (
    ID_PEDIDO NUMBER NOT NULL,
    ID_PRATO NUMBER NOT NULL,
    QUANTIDADE NUMBER DEFAULT 1,
    CONSTRAINT PK_ITEM_PEDIDO PRIMARY KEY (ID_PEDIDO, ID_PRATO),
    CONSTRAINT FK_ITEM_PEDIDO_PEDIDO FOREIGN KEY (ID_PEDIDO)
        REFERENCES PEDIDO(ID_PEDIDO),
    CONSTRAINT FK_ITEM_PEDIDO_PRATO FOREIGN KEY (ID_PRATO)
        REFERENCES PRATO(ID_PRATO)
);

